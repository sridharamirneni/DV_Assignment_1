<html>

<head>
  <title>Crimean War</title>
  <link type="text/css" rel="stylesheet" href="../ex.css" />
  <script type="text/javascript" src="protovis.js"></script>
  <script type="text/javascript" src="crimea.js"></script>
  <style type="text/css">
    #fig {
      width: 800px;
      height: 450px;
    }

    #title {
      font: 16px;
      text-transform: uppercase;
    }

    #caption {
      position: absolute;
      font: oblique 12px;
      top: 300px;
      left: 25px;
      width: 320px;
    }

    #caption p {
      margin: 0;
      text-indent: 12px;
    }
  </style>
</head>

<body>
  <div id="center">
    <div id="fig">
      <center id="title">
        Diagram of the Causes of Mortality<br>
        in the Army of the East
      </center>
      <script type="text/javascript+protovis">
        /* Compute maximum. */
        crimea.forEach(function(d) d.max = Math.max(350, d.wounds, d.other, d.disease));

        /* Scales for radius, angle, and fill. */
        var format = pv.Format.date("%b"),
          radius = pv.Scale.linear(0, 1400).range(0, 275),
          angle = pv.Scale.linear(0, 12).range(Math.PI / 2, 5 * Math.PI / 2),
          fill = pv.colors("pink", "gray", "cyan").domain(causes);

        var vis = new pv.Panel()
          .width(800)
          .height(450);

        /* Split the root panel by year. */
        var panel = vis.add(pv.Panel)
          .data([crimea.slice(12), crimea.slice(0, 12)])
          .left(function() this.index * 400);

        /* Add a panel per month, and sort causes by that month's deaths. */
        var wedge = panel.add(pv.Panel)
          .data(function(d) d)
          .add(pv.Wedge)
          .data(function(d) causes.sort(function(a, b) d[b] - d[a]))
          .left(200)
          .top(150)
          .angle(Math.PI / 6)
          .startAngle(function(c, d) angle(d.date.getMonth()))
          .outerRadius(function(c, d) radius(d[c]))
          .fillStyle(fill)
          .strokeStyle(function() this.fillStyle().darker())
          .lineWidth(1);

        /* Add a label using the pre-computed maximum value. */
        wedge.add(pv.Wedge)
          .data(["max"])
          .fillStyle(null)
          .strokeStyle(null)
          .anchor("outer").add(pv.Label)
          .text(function(c, d) format(d.date))
          .textAlign("center")
          .textBaseline("bottom")
          .textAngle(function() this.anchorTarget().midAngle() + Math.PI / 2);

        vis.render();
      </script>
    </div>
  </div>
</body>

</html>
